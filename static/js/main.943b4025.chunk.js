(window.webpackJsonpcvr_flyt_app=window.webpackJsonpcvr_flyt_app||[]).push([[0],{378:function(e,t){},439:function(e,t,a){e.exports=a(684)},444:function(e,t,a){},570:function(e,t,a){},598:function(e,t){},600:function(e,t){},635:function(e,t){},636:function(e,t){},680:function(e,t){},681:function(e,t){},684:function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),l=a.n(o),i=a(17),s=a.n(i),c=(a(444),a(153)),u=a(387),m=a.n(u),d=a(11),p=a(34),h=a(32),f=a(42),v=a(43),g=a(49),k=a(44),y=a(761),b=a(192),E=a(184),O=a(6),D=a(771),w=a(767),C=a(83),j=a(405),S=a.n(j),N=a(102),T=a(175),x=a(384),F=a(98),M=a.n(F),Y=(a(452),a(326)),_=a(766),L=a(267),P=a.n(L),H=a(406),V=a.n(H),B=a(407),A=a.n(B),J=a(408),K=a.n(J),R=a(268),U=a(48),I=a(770),W=a(64),q=a.n(W),G={width:"100%",height:"600px"},z=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this,e))).state={data:{}},a}return Object(k.a)(t,e),Object(h.a)(t,[{key:"renderMap",value:function(){var e=q.a.tileLayer.wms("https://services.kortforsyningen.dk/topo_skaermkort",{layers:"dtk_skaermkort_daempet",token:"d12107f70a3ee93153f313c7c502169a",format:"image/png",attribution:'&copy; <a target="_blank" href="https://download.kortforsyningen.dk/content/vilk%C3%A5r-og-betingelser">Styrelsen for Dataforsyning og Effektivisering</a>'});r=q.a.map("map",{center:[55.2,12.2],zoom:8,layers:[e]});var t=q.a.control({position:"bottomleft"});t.onAdd=function(e){var t=q.a.DomUtil.create("div","legend");return t.innerHTML+="<h4>Signaturforklaring</h4>",t.innerHTML+='<i style="background:#0020d7"></i><span>NyStartet</span><br>',t.innerHTML+='<i style="background:#d79700"></i><span>Fraflyttet</span><br>',t.innerHTML+='<i style="background:#298b30"></i><span>Tilflyttet</span><br>',t.innerHTML+='<i style="background:#c10a0a"></i><span>Oph\xf8rt</span><br>',t},t.addTo(r),q.a.control.scale().addTo(r)}},{key:"renderFeatures",value:function(e){var t=function(e){return q.a.icon({iconUrl:function(e){switch(e){case"Tilflytter":return"img/t.png";case"Fraflytter":return"img/f.png";case"Nystartet":return"img/n.png";case"Oph\xf8rt":return"img/o.png"}}(e),shadowUrl:"img/shadow.png",iconAnchor:[16,37],shadowAnchor:[20,35],popupAnchor:[0,-30]})};void 0!==n&&r.removeLayer(n),n=q.a.geoJSON(e,{onEachFeature:function(e,t){t.bindPopup("<strong>"+e.properties.status+"</strong></br><hr>"+e.properties.navn+'</br><a href="https://datacvr.virk.dk/data/visenhed?enhedstype=produktionsenhed&id='+e.properties["p-nummer"]+'" target="_blank">Se mere her</a>')},pointToLayer:function(e,a){return q.a.marker(a,{icon:t(e.properties.status)})}}).addTo(r);var a=function(e){var t=e.filter((function(e){return["Nystartet",""].includes(e.properties.status)}));return 0===t.length?null:t[0].geometry.coordinates}(e);a?r.setView([a[1],a[0]],12):r.fitBounds(n.getBounds())}},{key:"componentDidMount",value:function(){this.renderMap(),this.props.data.length>0&&this.renderFeatures(this.props.data)}},{key:"componentDidUpdate",value:function(){console.log("componentdidupdate"),this.props.data.length>0?this.renderFeatures(this.props.data):console.log("props empty")}},{key:"renderMarkers",value:function(e){var t=function(e){return q.a.icon({iconUrl:function(e){switch(e){case"Tilflytter":return"img/t.png";case"Fraflytter":return"img/f.png";case"Nystartet":return"img/n.png";case"Oph\xf8rt":return"img/o.png"}}(e),shadowUrl:"img/shadow.png",iconAnchor:[16,37],shadowAnchor:[20,35],popupAnchor:[0,-30]})};void 0!==n&&r.removeLayer(n),n=q.a.geoJSON(e,{onEachFeature:function(e,t){t.bindPopup("<strong>"+e.properties.status+"</strong></br><hr>"+e.properties.navn+'</br><a href="https://datacvr.virk.dk/data/visenhed?enhedstype=produktionsenhed&id='+e.properties["p-nummer"]+'" target="_blank">Se mere her</a>')},pointToLayer:function(e,a){return q.a.marker(a,{icon:t(e.properties.status)})}}).addTo(r)}},{key:"render",value:function(){return l.a.createElement("div",{id:"map",style:G})}}]),t}(l.a.Component),X=a(149),$=a(14),Q=a(133),Z=function(e){var t,a=e.value,n="Fraflytter"===(t=a)?"orange":"Tilflytter"===t?"green":"Nystartet"===t?"blue":"Oph\xf8rt"===t?"red":"blue";return l.a.createElement("b",{style:{color:n}},a)},ee=function(e){return l.a.createElement($.b,Object.assign({formatterComponent:Z},e))},te=function(e){var t=e.value,a="https://datacvr.virk.dk/data/visenhed?enhedstype=produktionsenhed&id=".concat(t);return l.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},t)},ae=function(e){return l.a.createElement($.b,Object.assign({formatterComponent:te},e))},ne=function(e){return e.keyIndex},re=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(f.a)(this,Object(v.a)(t).call(this,e))).state={rows:[],data:[],sorting:[{columnName:"hovedbranche",direction:"desc"}],statusColumns:["status"],pcols:["p-nummer"],grouping:[{columnName:"status"}]},a.changeSorting=function(e){return a.setState({sorting:e})},a.changeGrouping=function(e){return a.setState({grouping:e})},a}return Object(k.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this.state.statusColumns,t=this.state.pcols,a=this.props.data.map((function(e,t){return e.properties.keyIndex=t,[81,230,235,245,250].includes(e.properties.virksomhedsform)&&console.log(e.properties.virksomhedsform,": ",e.properties.navn),e.properties}));return l.a.createElement(X.a,{style:{height:"600px"}},l.a.createElement(Q.a,{rows:a,columns:[{name:"status",title:"Status"},{name:"cvr-nummer",title:"CVR nummer"},{name:"p-nummer",title:"P nummer"},{name:"hovedbranche",title:"Branche"},{name:"navn",title:"Virksomhedsnavn"},{name:"fuldt ansvarlige deltagere",title:"Kontaktperson"},{name:"kommunekode",title:"Kommunekode"},{name:"vejnavn",title:"Vejnavn"},{name:"husnummer",title:"Husnummer"},{name:"postnummer",title:"Postnummer"},{name:"postdistrikt",title:"By"},{name:"emailadresse",title:"Email"},{name:"indl\xe6st dato",title:"Indl\xe6st dato"}],getRowId:ne,style:{height:"100%"}},l.a.createElement($.d,{defaultFilters:[]}),l.a.createElement($.g,null),l.a.createElement($.k,{defaultSorting:[{columnName:"status",direction:"desc"}]}),l.a.createElement($.h,null),l.a.createElement(ee,{for:e}),l.a.createElement(ae,{for:t}),l.a.createElement(Q.e,{height:"auto"}),l.a.createElement(Q.b,{defaultColumnWidths:[{columnName:"status",width:120},{columnName:"cvr-nummer",width:120},{columnName:"p-nummer",width:120},{columnName:"hovedbranche",width:150},{columnName:"navn",width:150},{columnName:"fuldt ansvarlige deltagere",width:120},{columnName:"kommunekode",width:120},{columnName:"vejnavn",width:120},{columnName:"husnummer",width:120},{columnName:"postnummer",width:120},{columnName:"postdistrikt",width:120},{columnName:"emailadresse",width:120},{columnName:"indl\xe6st dato",width:120}]}),l.a.createElement(Q.d,{showSortingControls:!0}),l.a.createElement(Q.c,null)))}}]),t}(l.a.PureComponent),oe=a(769),le=a(773),ie=a(776),se=a(409),ce=function(e){function t(){var e;return Object(p.a)(this,t),(e=Object(f.a)(this,Object(v.a)(t).call(this))).state={clicked:!1,style:{data:{fill:"tomato"}}},e}return Object(k.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=function(e){var t=e.map((function(e){return e.properties})),a=t.filter((function(e){return"Tilflytter"===e.status})).length;return[{x:"Fraflytter",y:t.filter((function(e){return"Fraflytter"===e.status})).length},{x:"Tilflytter",y:a},{x:"Oph\xf8rt",y:t.filter((function(e){return"Oph\xf8rt"===e.status})).length},{x:"Nystartet",y:t.filter((function(e){return"Nystartet"===e.status})).length}]}(this.props.data);return l.a.createElement("div",null,l.a.createElement(X.a,{style:{height:"600px"}},l.a.createElement(oe.a,{height:200,width:200,domainPadding:{x:50,y:[0,20]},theme:le.a.material},l.a.createElement(ie.a,{dataComponent:l.a.createElement(se.a,{events:{onMouseOver:function(){var t=e.state.clicked?"blue":"tomato",a=!e.state.clicked;e.setState({clicked:a,style:{data:{fill:t}}})}}}),style:{data:{fill:function(e){return"Fraflytter"===e.x?"orange":"Tilflytter"===e.x?"green":"Oph\xf8rt"===e.x?"red":"Nystartet"===e.x?"blue":void 0}}},data:t,labels:function(e){return e.y}}))))}}]),t}(l.a.Component),ue=a(404),me=a.n(ue),de=["Name","Company","City","State"],pe=[["Joe James","Test Corp","Yonkers","NY"],["John Walsh","Test Corp","Hartford","CT"],["Bob Herm","Test Corp","Tampa","FL"],["James Houston","Test Corp","Dallas","TX"]],he=(l.a.PureComponent,a(570),a(15)),fe=a.n(he),ve=a(205),ge=a.n(ve),ke=a(273),ye=a.n(ke);M.a.locale("da");var be=ge.a.ExcelFile,Ee=ge.a.ExcelFile.ExcelSheet,Oe=ge.a.ExcelFile.ExcelColumn,De=Object(T.a)({typography:{useNextVariants:!0,suppressDeprecationWarnings:!0}});function we(e){return l.a.createElement("div",null,e.children)}var Ce=function(e){function t(e){var a;return Object(p.a)(this,t),a=Object(f.a)(this,Object(v.a)(t).call(this,e)),console.log("komrn ",a.props.komnr),a.state={value:0,startDate:M()().subtract(1,"months").startOf("month").format("YYYY-MM-DD"),endDate:M()().subtract(1,"months").endOf("month").format("YYYY-MM-DD"),data:[],filteredData:[],kommuner:[],komkode:a.props.komnr,Fraflytter:!0,Tilflytter:!0,"Oph\xf8rt":!0,Nystartet:!0,csvData:[],loading:!0,completed:0,canSendRequest:!1},a.theData={},a.handleChange=a.handleChange.bind(Object(g.a)(a)),a.handleStart=a.handleStart.bind(Object(g.a)(a)),a.handleEnd=a.handleEnd.bind(Object(g.a)(a)),a.handleSelect=a.handleSelect.bind(Object(g.a)(a)),a.handleChecked=a.handleChecked.bind(Object(g.a)(a)),a.progress=a.progress.bind(Object(g.a)(a)),a.handleDoneClick=a.handleDoneClick.bind(Object(g.a)(a)),a}return Object(k.a)(t,e),Object(h.a)(t,[{key:"progress",value:function(){var e=this.state.completed;this.setState({completed:e>=100?0:e+1})}},{key:"getCsv",value:function(){return this.state.data.map((function(e){var t=e.properties["fuldt ansvarlige deltagere"];return null!==t&&t.length>0&&(e.properties["fuldt ansvarlige deltagere"]=t.replace(/"/g,"")),e.properties}))}},{key:"filterData",value:function(e){var t=this.state,a=t.Fraflytter,n=t.Tilflytter,r=t.Oph\u00f8rt,o=t.Nystartet,l=[];return a&&l.push("Fraflytter"),n&&l.push("Tilflytter"),r&&l.push("Oph\xf8rt"),o&&l.push("Nystartet"),l.indexOf(e.properties.status)>-1}},{key:"getKommuner",value:function(){var e=this;ye.a.ajax({url:"https://drayton.mapcentia.com/api/v1/sql/ballerup?q=select right(komkode, 3)::int komkode, komnavn from data.kommune group by komkode, komnavn order by komnavn",type:"GET",dataType:"jsonp",success:function(t){var a=t.features.map((function(e){return e.properties}));e.setState((function(e){return{kommuner:a}}))}})}},{key:"getData",value:function(e,t,a){this.setState((function(e){return{csvData:[],loading:!0}}));var n=this;if(e){var r="https://drayton.mapcentia.com/api/v1/sql/ballerup?q=SELECT * FROM cvr.flyt_fad_dev("+e+",'2019-08-01','2019-08-31')&srs=4326";console.log(r),ye.a.ajax({url:r,type:"GET",dataType:"jsonp",success:function(e){n.setState((function(t){return{data:e.features}}));var t=e.features.map((function(e){return e.properties}));n.setState((function(e){return{csvData:t,loading:!1}}))}})}else this.setState({loading:!1})}},{key:"handleChecked",value:function(e){var t=this;e.persist();var a=this.state,n=a.data,r=a.Fraflytter,o=a.Tilflytter,l=a.Oph\u00f8rt,i=a.Nystartet;this.setState((function(t){return Object(d.a)({},e.target.value,e.target.checked)}),(function(){r=t.state.Fraflytter,o=t.state.Tilflytter,l=t.state.Oph\u00f8rt,i=t.state.Nystartet}));var s=[];r&&s.push("Fraflytter"),o&&s.push("Tilflytter"),l&&s.push("Oph\xf8rt"),i&&s.push("Nystartet");var c=n.filter((function(e){return s.indexOf(e.properties.status)>-1}));this.setState({data:c})}},{key:"handleSelect",value:function(e){e.persist(),this.setState((function(t){return{komkode:e.target.value}}))}},{key:"componentDidMount",value:function(){var e=this.state,t=e.komkode,a=e.startDate,n=e.endDate;this.getData(t,a,n),this.getKommuner()}},{key:"componentWillUnmount",value:function(){}},{key:"handleChange",value:function(e,t){this.setState({value:t})}},{key:"handleDoneClick",value:function(){var e=this.state,t=e.komkode,a=e.startDate,n=e.endDate;this.getData(t,a,n),console.log("before navigating"),Object(c.c)(t)}},{key:"handleStart",value:function(e){this.setState({startDate:e.format("YYYY-MM-DD")})}},{key:"handleEnd",value:function(e){this.setState({endDate:e.format("YYYY-MM-DD")})}},{key:"render",value:function(){var e=this;console.log("props from router => ",this.props.komnr);var t=this.state,a=t.value,n=t.startDate,r=t.endDate,o=t.kommuner,i=t.komkode;return l.a.createElement(x.a,{theme:De},l.a.createElement("div",{className:"app"},l.a.createElement("div",{className:this.state.loading?"loading":""}),l.a.createElement("div",{className:""},l.a.createElement(y.a,{position:"static",color:"default"},l.a.createElement(b.a,null,l.a.createElement(_.a,{container:!0},l.a.createElement(_.a,{item:!0,xs:2},l.a.createElement(N.a,{variant:"h6",color:"inherit"},"CVR Flyttem\xf8nster")),l.a.createElement(_.a,{item:!0,xs:2},l.a.createElement("form",{className:fe.a.container,noValidate:!0,autoComplete:"off"},l.a.createElement(Y.a,{id:"standard-select",select:!0,label:"Kommune",placeholder:"Placeholder",className:fe.a.textField,value:this.state.komkode||"",onChange:this.handleSelect,SelectProps:{native:!0},helperText:"",InputLabelProps:{shrink:!0}},o.map((function(t){return e.state.komkode===t.komkode&&"selected"&&console.log(t.komnavn),l.a.createElement("option",{key:t.komkode,value:t.komkode},t.komnavn)}))))),l.a.createElement(_.a,{item:!0,xs:2},l.a.createElement(U.a,{utils:R.a,locale:"da",moment:M.a},l.a.createElement(I.a,{value:n,label:"Startdato",format:"DD MMM YYYY",onChange:this.handleStart}))),l.a.createElement(_.a,{item:!0,xs:2},l.a.createElement(U.a,{utils:R.a},l.a.createElement(I.a,{value:r,label:"Slutdato",format:"DD MMM YYYY",onChange:this.handleEnd}))),l.a.createElement(_.a,{item:!0,xs:2},l.a.createElement(C.a,{"arial-label":"Done",onClick:this.handleDoneClick},l.a.createElement(S.a,null))),l.a.createElement(_.a,{item:!0,xs:2},this.state.csvData.length>0&&l.a.createElement(be,{element:l.a.createElement(C.a,{"arial-label":"Excel"},l.a.createElement(P.a,null)),filename:"export_"+i+"_"+n+"_"+r},l.a.createElement(Ee,{data:this.state.csvData,name:"CVR"},l.a.createElement(Oe,{label:"Status",value:"status"}),l.a.createElement(Oe,{label:"CVR nummer",value:"cvr-nummer"}),l.a.createElement(Oe,{label:"P nummer",value:"p-nummer"}),l.a.createElement(Oe,{label:"Branche",value:"hovedbranche"}),l.a.createElement(Oe,{label:"Virksomhedsnavn",value:"navn"}),l.a.createElement(Oe,{label:"Kontaktperson",value:"fuldt ansvarlige deltagere"}),l.a.createElement(Oe,{label:"Kommunekode",value:"kommunekode"}),l.a.createElement(Oe,{label:"vejnavn",value:"vejnavn"}),l.a.createElement(Oe,{label:"Husnummer",value:"husnummer"}),l.a.createElement(Oe,{label:"Postnummer",value:"postnummer"}),l.a.createElement(Oe,{label:"By",value:"postdistrikt"}),l.a.createElement(Oe,{label:"Email",value:"emailadresse"}),l.a.createElement(Oe,{label:"Indl\xe6st dato",value:"indl\xe6st dato"}))))))),l.a.createElement(D.a,{value:a,onChange:this.handleChange,centered:!0},l.a.createElement(w.a,{icon:l.a.createElement(E.a,{title:"Kort"},l.a.createElement(V.a,null))}),l.a.createElement(w.a,{icon:l.a.createElement(E.a,{title:"Tabel"},l.a.createElement(A.a,null)),"aria-label":"Tabel"}),l.a.createElement(w.a,{icon:l.a.createElement(E.a,{title:"Grapher"},l.a.createElement(K.a,null))})),0===a&&l.a.createElement(we,null,l.a.createElement(z,{data:this.state.data})),1===a&&l.a.createElement(we,null,l.a.createElement(re,{data:this.state.data})),2===a&&l.a.createElement(we,null,l.a.createElement(ce,{data:this.state.data})))))}}]),t}(o.Component),je=Object(O.a)((function(e){return{root:{flexGrow:1},container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:200},dense:{marginTop:19},menu:{width:300},progress:{margin:2*e.spacing(1)}}}))(Ce),Se=m()(),Ne=(Object(c.b)(Se),function(){return l.a.createElement(c.a,null,l.a.createElement(je,{path:"/"}),l.a.createElement(je,{path:"/:komnr"}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(l.a.createElement(Ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[439,1,2]]]);
//# sourceMappingURL=main.943b4025.chunk.js.map